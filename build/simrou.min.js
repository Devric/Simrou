/*
 Simrou - Simple javascript routing framework
 Copyright (c) 2012 büro für ideen, www.buero-fuer-ideen.de
*/
(function(f,m,p){var k,e;k=function(h){if(!(this instanceof k))return new k(h);var c=this,g=m.location,i={},j=!1,a=function(a,c){var b=a instanceof e?a:new e(a);c&&(f.isFunction(c)?b.attachAction(c):b.attachActions(c));return i[b.getRegExp().toString()]=b},b=function(c){var b;if(f.isArray(c)){b=[];for(var d=0;d<c.length;d++)b.push(a(c[d]))}else for(d in b={},c)b[d]=a(d,c[d]);return b},d=function(a){var b=g.hash!=a;g.hash=a;(!j||!b)&&l(a,"get");return c},l=function(a,c){var b,d,e;if(!a)return!1;for(d in i)if(b=
i[d],e=b.match(a),!1!==e)return e.unshift(c),b=f(b),b.trigger("simrou:*",e),c&&b.trigger("simrou:"+c.toLowerCase(),e),!0;return!1},n=function(a){a=(a.originalEvent.newURL||g.hash).replace(/^[^#]*#+(.*)$/,"$1");l(a,"get")},o=function(){var a=f(this),c=""+a.attr("method")||"get",a=a.attr("action");return!l(a,c)};c.addRoute=a;c.addRoutes=b;c.removeRoute=function(a){a instanceof e||(a=new e(a));a=a.getRegExp().toString();i[a]&&delete i[a];return c};c.start=function(a,b,e){if("undefined"==typeof b||b)f(m).on("hashchange",
n),j=!0;if("undefined"==typeof e||e)f("body").on("submit","form",o);b=g.hash.replace(/^[^#]*#+(.*)$/,"$1");""==b?a&&d(a):l(b,"get");return c};c.stop=function(){f(m).off("hashchange",n);j=!1;f("body").off("submit","form",o);return c};c.navigate=d;c.resolve=l;h&&b(h);return c};e=function(h){var c=this,g,i=function(a,b){!b&&f.isFunction(a)&&(b=a,a="*");f(c).on("simrou:"+a.toLowerCase(),b);return c},j=function(a){return function(b){return i(a,b)}};c.match=function(a){a=g.exec(a);return!f.isArray(a)?!1:
a.slice(1)};c.getRegExp=function(){return g};c.attachAction=i;c.attachActions=function(a,b){if(f.isArray(a))b={"*":a};else if(f.isPlainObject(a))b=a;else{var d={};d[a]=b;b=d}for(a in b){d=b[a];f.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++)i(a,d[e])}return c};c.detachAction=function(a,b){!b&&f.isFunction(a)&&(b=a,a="*");f(c).off("simrou:"+a.toLowerCase(),f.isFunction(b)?b:p);return c};c.assemble=function(a){if(h instanceof RegExp)throw"Assembling routes that are based on a regular expression is not supported.";
f.isArray(a)||(a=Array.prototype.slice.call(arguments));for(var b=h,d=0,g;e.firstParam.test(b);)g=!a[d]&&0!==a[d]?"":f.isFunction(a[d])?a[d].call(c):""+a[d],b=b.replace(e.firstParam,g),d++;return b};c.get=j("get");c.post=j("post");c.put=j("put");c["delete"]=c.del=j("delete");h instanceof RegExp?g=h:h?(h=""+h,g=RegExp("^"+h.replace(e.escapeRegExp,"$&").replace(e.namedParam,"([^/]+)").replace(e.splatParam,"(.*?)")+"$")):g=/^.+$/};e.escapeRegExp=/[-[\]{}()+?.,\^$|#\s]/g;e.namedParam=/:\w+/g;e.splatParam=
/\*\w*/g;e.firstParam=/(:\w+)|(\*\w*)/;k.version="1.2.0";m.Simrou=k})(jQuery,this);
