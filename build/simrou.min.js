/*
 Simrou - Simple javascript routing framework
 Copyright (c) 2012 büro für ideen, www.buero-fuer-ideen.de
*/
(function(e,m,q){var n=m.location,k,f;k=function(d){if(!(this instanceof k))return new k(d);var b=this,h={},j=!1,i=function(l,a){var b=l instanceof f?l:new f(l);a&&(e.isFunction(a)?b.attachAction(a):b.attachActions(a));return h[b.getRegExp().toString()]=b},a=function(a){var b;if(e.isArray(a)){b=[];for(var c=0;c<a.length;c++)b.push(i(a[c]))}else b={},e.each(a,function(a,l){b[a]=i(a,l)});return b},c=function(a){var c=n.hash!=a;n.hash=a;(!j||!c)&&g(a,"get");return b},g=function(a,b){var c,g,d;if(!a)return!1;
for(g in h)if(c=h[g],c instanceof f&&(d=c.match(a),!1!==d))return d.unshift(b),c=e(c),c.trigger("simrou:*",d),b&&c.trigger("simrou:"+b.toLowerCase(),d),!0;return!1},o=function(a){a=(a.originalEvent.newURL||n.hash).replace(/^[^#]*#+(.*)$/,"$1");g(a,"get")},p=function(a){var b=e(this),c=""+b.attr("method")||"get",b=b.attr("action");g(b,c)&&a.preventDefault()};b.addRoute=i;b.addRoutes=a;b.removeRoute=function(a){a instanceof f||(a=new f(a));a=a.getRegExp().toString();h[a]&&delete h[a];return b};b.start=
function(a,d,f){if("undefined"==typeof d||d)e(m).on("hashchange",o),j=!0;if("undefined"==typeof f||f)e("body").on("submit","form",p);d=n.hash.replace(/^[^#]*#+(.*)$/,"$1");""==d?a&&c(a):g(d,"get");return b};b.stop=function(){e(m).off("hashchange",o);j=!1;e("body").off("submit","form",p);return b};b.navigate=c;b.resolve=g;d&&a(d);return b};f=function(d){var b=this,h,j=function(a,c){!c&&e.isFunction(a)&&(c=a,a="*");e(b).on("simrou:"+a.toLowerCase(),c);return b},i=function(a){return function(b){return j(a,
b)}};b.match=function(a){a=h.exec(a);return!e.isArray(a)?!1:a.slice(1)};b.getRegExp=function(){return h};b.attachAction=j;b.attachActions=function(a,c){if(e.isArray(a))c={"*":a};else if(e.isPlainObject(a))c=a;else{var d={};d[a]=c;c=d}e.each(c,function(a,b){e.isArray(b)||(b=[b]);for(var c=0;c<b.length;c++)j(a,b[c])});return b};b.detachAction=function(a,c){!c&&e.isFunction(a)&&(c=a,a="*");e(b).off("simrou:"+a.toLowerCase(),e.isFunction(c)?c:q);return b};b.assemble=function(a){if(d instanceof RegExp)throw"Assembling routes that are based on a regular expression is not supported.";
e.isArray(a)||(a=Array.prototype.slice.call(arguments));for(var c=d,g=0,h;f.firstParam.test(c);)h=!a[g]&&0!==a[g]?"":e.isFunction(a[g])?a[g].call(b):""+a[g],c=c.replace(f.firstParam,h),g++;return c};b.get=i("get");b.post=i("post");b.put=i("put");b["delete"]=b.del=i("delete");d instanceof RegExp?h=d:d?(d=""+d,h=RegExp("^"+d.replace(f.escapeRegExp,"$&").replace(f.namedParam,"([^/]+)").replace(f.splatParam,"(.*?)")+"$")):h=/^.+$/};f.escapeRegExp=/[-[\]{}()+?.,\^$|#\s]/g;f.namedParam=/:\w+/g;f.splatParam=
/\*\w*/g;f.firstParam=/(:\w+)|(\*\w*)/;k.version="1.2.1";m.Simrou=k})(jQuery,this);
