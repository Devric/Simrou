/*
 Simrou - Simple javascript routing framework
 Copyright (c) 2012 büro für ideen, www.buero-fuer-ideen.de
*/
(function(e,g,o){var k=g.location,p=g.document.documentMode,s="onhashchange"in g&&(p===o||7<p),l,f;l=function(d){if(!(this instanceof l))return new l(d);var b=this,i={},n=!1,j=function(m,a){var b=m instanceof f?m:new f(m);a&&(e.isFunction(a)?b.attachAction(a):b.attachActions(a));return i[b.getRegExp().toString()]=b},a=function(a){var b;if(e.isArray(a)){b=[];for(var c=0;c<a.length;c++)b.push(j(a[c]))}else b={},e.each(a,function(a,m){b[a]=j(a,m)});return b},c=function(a){var c=k.hash!=a;k.hash=a;(!n||
!c)&&h(a,"get");return b},h=function(a,b){var c,h,d;if(!a)return!1;for(h in i)if(c=i[h],c instanceof f&&(d=c.match(a),!1!==d))return d.unshift(b),c=e(c),c.trigger("simrou:*",d),b&&c.trigger("simrou:"+b.toLowerCase(),d),!0;return!1},q=function(a){h(((s?a.originalEvent.newURL:k.hash)||k.hash).replace(/^[^#]*#+(.*)$/,"$1"),"get")},r=function(a){var b=e(this),c=""+b.attr("method")||"get",b=b.attr("action");h(b,c)&&a.preventDefault()};b.addRoute=j;b.addRoutes=a;b.removeRoute=function(a){a instanceof f||
(a=new f(a));a=a.getRegExp().toString();i[a]&&delete i[a];return b};b.start=function(a,d,f){if("undefined"==typeof d||d)e(g).on("hashchange",q),n=!0;if("undefined"==typeof f||f)e("body").on("submit","form",r);d=k.hash.replace(/^[^#]*#+(.*)$/,"$1");""==d?a&&(g.history&&g.history.replaceState?(g.history.replaceState({},document.title,"#"+a.replace(/^#+/,"")),h(a,"get")):e(function(){c(a)})):h(d,"get");return b};b.stop=function(){e(g).off("hashchange",q);n=!1;e("body").off("submit","form",r);return b};
b.navigate=c;b.resolve=h;d&&a(d);return b};f=function(d){var b=this,i,g=function(a,c){!c&&e.isFunction(a)&&(c=a,a="*");e(b).on("simrou:"+a.toLowerCase(),c);return b},j=function(a){return function(b){return g(a,b)}};b.match=function(a){a=i.exec(a);return!e.isArray(a)?!1:a.slice(1)};b.getRegExp=function(){return i};b.attachAction=g;b.attachActions=function(a,c){if(e.isArray(a))c={"*":a};else if(e.isPlainObject(a))c=a;else{var d={};d[a]=c;c=d}e.each(c,function(a,b){e.isArray(b)||(b=[b]);for(var c=0;c<
b.length;c++)g(a,b[c])});return b};b.detachAction=function(a,c){!c&&e.isFunction(a)&&(c=a,a="*");e(b).off("simrou:"+a.toLowerCase(),e.isFunction(c)?c:o);return b};b.assemble=function(a){if(d instanceof RegExp)throw"Assembling routes that are based on a regular expression is not supported.";e.isArray(a)||(a=Array.prototype.slice.call(arguments));for(var c=d,h=0,g;f.firstParam.test(c);)g=!a[h]&&0!==a[h]?"":e.isFunction(a[h])?a[h].call(b):""+a[h],c=c.replace(f.firstParam,g),h++;return c};b.get=j("get");
b.post=j("post");b.put=j("put");b["delete"]=b.del=j("delete");d instanceof RegExp?i=d:d?(d=""+d,i=RegExp("^"+d.replace(f.escapeRegExp,"$&").replace(f.namedParam,"([^/]+)").replace(f.splatParam,"(.*?)")+"$")):i=/^.+$/};f.escapeRegExp=/[-[\]{}()+?.,\^$|#\s]/g;f.namedParam=/:\w+/g;f.splatParam=/\*\w*/g;f.firstParam=/(:\w+)|(\*\w*)/;l.version="1.2.2";g.Simrou=l})(jQuery,this);
