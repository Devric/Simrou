/*
 Simrou - Simple javascript routing framework
 Copyright (c) 2012 büro für ideen, www.buero-fuer-ideen.de
*/
(function(e,l,p){var m=l.location,k,d;k=function(f){if(!(this instanceof k))return new k(f);var c=this,h={},j=!1,i=function(a,c){var b=a instanceof d?a:new d(a);c&&(e.isFunction(c)?b.attachAction(c):b.attachActions(c));return h[b.getRegExp().toString()]=b},a=function(a){var c;if(e.isArray(a)){c=[];for(var b=0;b<a.length;b++)c.push(i(a[b]))}else for(b in c={},a)c[b]=i(b,a[b]);return c},b=function(a){var b=m.hash!=a;m.hash=a;(!j||!b)&&g(a,"get");return c},g=function(a,c){var b,g,d;if(!a)return!1;for(g in h)if(b=
h[g],d=b.match(a),!1!==d)return d.unshift(c),b=e(b),b.trigger("simrou:*",d),c&&b.trigger("simrou:"+c.toLowerCase(),d),!0;return!1},n=function(a){a=(a.originalEvent.newURL||m.hash).replace(/^[^#]*#+(.*)$/,"$1");g(a,"get")},o=function(){var a=e(this),b=""+a.attr("method")||"get",a=a.attr("action");return!g(a,b)};c.addRoute=i;c.addRoutes=a;c.removeRoute=function(a){a instanceof d||(a=new d(a));a=a.getRegExp().toString();h[a]&&delete h[a];return c};c.start=function(a,d,f){if("undefined"==typeof d||d)e(l).on("hashchange",
n),j=!0;if("undefined"==typeof f||f)e("body").on("submit","form",o);d=m.hash.replace(/^[^#]*#+(.*)$/,"$1");""==d?a&&b(a):g(d,"get");return c};c.stop=function(){e(l).off("hashchange",n);j=!1;e("body").off("submit","form",o);return c};c.navigate=b;c.resolve=g;f&&a(f);return c};d=function(f){var c=this,h,j=function(a,b){!b&&e.isFunction(a)&&(b=a,a="*");e(c).on("simrou:"+a.toLowerCase(),b);return c},i=function(a){return function(b){return j(a,b)}};c.match=function(a){a=h.exec(a);return!e.isArray(a)?!1:
a.slice(1)};c.getRegExp=function(){return h};c.attachAction=j;c.attachActions=function(a,b){if(e.isArray(a))b={"*":a};else if(e.isPlainObject(a))b=a;else{var d={};d[a]=b;b=d}for(a in b){d=b[a];e.isArray(d)||(d=[d]);for(var f=0;f<d.length;f++)j(a,d[f])}return c};c.detachAction=function(a,b){!b&&e.isFunction(a)&&(b=a,a="*");e(c).off("simrou:"+a.toLowerCase(),e.isFunction(b)?b:p);return c};c.assemble=function(a){if(f instanceof RegExp)throw"Assembling routes that are based on a regular expression is not supported.";
e.isArray(a)||(a=Array.prototype.slice.call(arguments));for(var b=f,g=0,h;d.firstParam.test(b);)h=!a[g]&&0!==a[g]?"":e.isFunction(a[g])?a[g].call(c):""+a[g],b=b.replace(d.firstParam,h),g++;return b};c.get=i("get");c.post=i("post");c.put=i("put");c["delete"]=c.del=i("delete");f instanceof RegExp?h=f:f?(f=""+f,h=RegExp("^"+f.replace(d.escapeRegExp,"$&").replace(d.namedParam,"([^/]+)").replace(d.splatParam,"(.*?)")+"$")):h=/^.+$/};d.escapeRegExp=/[-[\]{}()+?.,\^$|#\s]/g;d.namedParam=/:\w+/g;d.splatParam=
/\*\w*/g;d.firstParam=/(:\w+)|(\*\w*)/;k.version="1.2.0";l.Simrou=k})(jQuery,this);
